!function(){"use strict";function e(e,t,o){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var o=e[Symbol.toPrimitive];if(void 0!==o){var n=o.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function t(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function o(o){for(var n=1;n<arguments.length;n++){var a=null!=arguments[n]?arguments[n]:{};n%2?t(Object(a),!0).forEach((function(t){e(o,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(a)):t(Object(a)).forEach((function(e){Object.defineProperty(o,e,Object.getOwnPropertyDescriptor(a,e))}))}return o}var n=/(loc\.17173\.com)|debug=followgame/.test(location.href),a=function(){if(n){for(var e,t=arguments.length,o=new Array(t),a=0;a<t;a++)o[a]=arguments[a];(e=console).log.apply(e,[(new Date).toLocaleTimeString()].concat(o))}},r=function(e,t){window.ued&&window.ued.emitter.on(e,t)},i=function(e,t){!function(e){window.dsm&&dsm.call("track",dsm.E.custom,e)}({name:e,module:t}),window.ued&&window.ued.emitter.fire(e,t)},l=function(e,t,o){var n="",r=t,i=r.game_code,l=r.channel,s=r.operator_id,d=Passport.data("uid");switch(e){case"scheGame":n="//api.17173.com/hao/v1/scheGame",t={channel:l,passport_id:d,game_code:i,operator_id:s,cur_url:encodeURIComponent(location.href),referer:encodeURIComponent(document.referrer),did:ued.pingjs&&ued.pingjs.get("did")||""};break;case"isUserScheGame":n="//api.17173.com/hao/v1/IsUserScheGame",t={passport_id:d,game_codes:i}}a("请求参数",n,t),$.ajax({url:n,dataType:"jsonp",data:t}).done((function(e){a(e),o(e)})).fail((function(e){a(e)}))},s=function(e){if(a("是否登录",Passport.isLoggedIn()),!Passport.isLoggedIn())return Passport.Dialog.show();Passport.getMobileStatus((function(t){if(a("绑定状态",t),!1===t){if(n)var o=setTimeout((function(){a("模拟已经绑定手机号"),Passport.core.fireEvent(Passport.EVENTS.mobileBindSucess),clearTimeout(o)}),3e3);return Passport.Dialog.show({type:"mobileBind",loginNum:-1})}e()}))};var d=function(e){!1!==ued.reserve.data.ui&&(!function(e){if($(".ue-game-follow-dialog").length>0)return $(".ue-game-follow-dialog").show();var t='<div class="ue-game-follow-dialog">\n    <div class="ue-game-follow-dialog-in">\n        <a href="javascript:;" onclick="$(\'.ue-game-follow-dialog\').hide()" class="ue-game-follow-dialog-close">x</a>\n        <div class="ue-game-follow-result">'.concat(e,'</div>\n        <div class="ue-game-follow-note">关注17173公众号，游戏状态第一时间通知!</div>\n        <div class="ue-game-follow-qrcode">\n            <img src="https://i.17173cdn.com/2fhnvk/YWxqaGBf/cms3/msOVBEbskmtxFoz.jpg!a-3-240x.jpg" alt="" />\n        </div>\n    </div>\n</div>');$("body").append(t+"<style>\n.ue-game-follow-dialog {\n    position: fixed;\n    z-index: 9999;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 100%;\n    font-size: 16px;\n    color: #333;\n    background: rgba(0, 0, 0, 0.4);\n}\n.ue-game-follow-dialog .ue-game-follow-dialog-in {\n    width: 450px;\n}\n.ue-game-follow-qrcode{\n  text-align:center;\n  padding:0 0 20px 0;\n}\n.ue-game-follow-qrcode img{\n  width:230px;\n  height:230px;\n  border:1px solid #efefef;\n  border-radius:10px;\n}\n.ue-game-follow-dialog-in {\n    position: absolute;\n    top: 20%;\n    left: 50%;\n    margin:0 0 0 -225px;\n    background: #fff;\n    border-radius: 0.5em;\n}\n.ue-game-follow-dialog a {\n    text-decoration: none;\n}\n\n.ue-game-follow-dialog-close {\n    position: absolute;\n    top: -5px;\n    right: -50px;\n    width: 40px;\n    height: 40px;\n    line-height:40px;\n    color:#fff;\n    text-align: center;\n    font-size:40px;\n}\n\n.ue-game-follow-result {\n    padding: 1em 0 0.5em;\n    font-size: 32px;\n    text-align: center;\n    font-weight:bold;\n}\n.ue-game-follow-note {\n    margin: 20px 0;\n    font-size: 16px;\n    font-weight: 700;\n    line-height: 1.3;\n    color: #222;\n    text-align: center;\n}\n</style>")}(e),$(".ue-game-follow-result").html(e),$(".ue-game-follow-dialog").show())},u={RESERVE_INIT:"reserve_init",RESERVE_START:"reserve_start",RESERVE_SUCCESS:"reserve_success",RESERVE_FAIL:"reserve_fail",RESERVE_FOLLOWED:"reserve_reserved",RESERVE_UPDATE_STATUS:"reserve_update_status",RESERVE_UPDATE_STATUS_SUCCESS:"reserve_update_status_success",RESERVE_GAME_STATUS:"reserve_game_status"},c={E:u,data:{followButton:"[data-tg-widget=reserve]",followCodeAttr:"data-reserve-gamecode",followStatusAttr:"data-reserve-status",isFollowing:!1,currentTarget:null,followType:"1",ui:!0,gameStatus:[]},ui:function(e){this.data.ui=e},getTip:function(){return"2"===this.data.followType?{success:"关注成功",fail:"关注失败"}:{success:"预约成功",fail:"预约失败"}},config:function(e){a("加载配置"),this.data=o(o({},this.data),e||{}),!e&&window.Passport&&(this.init(),i(u.RESERVE_INIT))},reset:function(){this.data.isFollowing=!1,this.data.currentTarget=null},follow:function(e){var t=this;if(this.data.isFollowing){var o=$(this.data.currentTarget).attr(this.data.followCodeAttr),n=this.data.followType,a=window.article?window.article.infoChannel:window.ued&&window.ued.pageInfo?window.ued.pageInfo.channel:"";l("scheGame",{game_code:o,channel:a,operator_id:this.data.followType},(function(e){"success"==e.result?(d(t.getTip().success),t.reset(),$(t.data.currentTarget).attr(t.data.followStatusAttr,!0),i(u.RESERVE_SUCCESS,{gameCode:o,operator_id:n})):(d(t.getTip().fail),i(u.RESERVE_FAIL,{gameCode:o,operator_id:n}))}))}},updateFollowStatus:function(){var e=this,t=$(this.data.followButton).filter((function(t,o){return"true"!==$(o).attr(e.data.followStatusAttr)})).map((function(t,o){return $(o).attr(e.data.followCodeAttr)})).get();a("所有按钮预约状态",t),0!=t.length&&Passport.isLoggedIn()&&l("isUserScheGame",{game_code:t.join(",")},(function(t){if("success"==t.result){for(var o in t.data)$("[".concat(e.data.followCodeAttr,"=").concat(o,"]")).attr(e.data.followStatusAttr,t.data[o]);i(u.RESERVE_UPDATE_STATUS_SUCCESS,t.data)}}))},getGameStatus:function(e,t){var o=this,n=function(){var n=0===DATASTORE["game-detail.info"][e].is_open_beta?1:2,a={reserveCode:n,reserveText:{default:1===n?"预约":"关注",result:1===n?"已预约":"已关注"},gameCode:e};i(u.RESERVE_GAME_STATUS,a),t.call(o,a)};if(window.DATASTORE&&window.DATASTORE["game-detail.info"]&&window.DATASTORE["game-detail.info"][e])return n();$.getScript("//d.17173cdn.com/newgame/info/js/".concat(e,".js")).done(n)},init:function(){var e=this;$(document).on("click",this.data.followButton,(function(t){t.preventDefault();var o=$(t.currentTarget).attr(e.data.followCodeAttr);if(e.data.followType=$(t.currentTarget).attr("data-reserve-opid"),"true"===$(t.currentTarget).attr(e.data.followStatusAttr))return d(e.getTip().success),void i(u.RESERVE_FOLLOWED,{gameCode:o,followType:e.data.followType});i(u.RESERVE_START,{gameCode:o,followType:e.data.followType}),e.reset(),e.data.isFollowing=t,e.data.currentTarget=t.currentTarget,s((function(){return e.follow()}))})),Passport.on(Passport.EVENTS.mobileBindSucess,(function(){a("手机绑定成功"),e.follow()})),Passport.on(Passport.EVENTS.loginSuccess,(function(){a("登录成功"),s((function(){return e.follow()}))})),Passport.on(Passport.EVENTS.dialogClose,(function(t){"mobileBind"===t.type&&e.reset()})),r(u.RESERVE_UPDATE_STATUS,(function(){return e.updateFollowStatus()})),$((function(){return i(u.RESERVE_UPDATE_STATUS)}))}};if("undefined"==typeof jQuery){var f=document.createElement("script");f.src="https://ue.17173cdn.com/a/lib/jquery-2.1.1.min.js",f.type="text/javascript",f.async=!0,document.head.appendChild(f)}window.ued&&!window.ued.reserve&&(r("passport-loaded",(function(){return c.config()})),ued.reserve=c)}();
